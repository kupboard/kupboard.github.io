(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[740],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return m}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),s=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=s(e.components);return r.createElement(i.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),d=s(t),m=a,k=d["".concat(i,".").concat(m)]||d[m]||p[m]||o;return t?r.createElement(k,l(l({ref:n},c),{},{components:t})):r.createElement(k,l({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=d;var u={};for(var i in n)hasOwnProperty.call(n,i)&&(u[i]=n[i]);u.originalType=e,u.mdxType="string"==typeof e?e:a,l[1]=u;for(var s=2;s<o;s++)l[s]=t[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6939:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return l},metadata:function(){return u},toc:function(){return i},default:function(){return c}});var r=t(2122),a=t(9756),o=(t(7294),t(3905)),l={},u={unversionedId:"cluster-management",id:"cluster-management",isDocsHomePage:!1,title:"Cluster Management",description:"Cluster Management is the feature to manage server instancess on a cloud environment. Before 0.9.5, the server instances must be prepared and the IP addresses of the servers need to be defined in kupboard.yaml. However, after 0.9.5, server instances are automatically created by kupboard based on the cluster structure defined in kupboard.yaml.",source:"@site/docs/cluster-management.md",sourceDirName:".",slug:"/cluster-management",permalink:"/kr/docs/cluster-management",editUrl:"https://github.com/kupboard/kupboard-docs/edit/main/docs/cluster-management.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Configuration",permalink:"/kr/docs/configuration"},next:{title:"Multi Cloud",permalink:"/kr/docs/multi-cloud"}},i=[{value:"Cluster",id:"cluster",children:[]},{value:"Cluster Group",id:"cluster-group",children:[]},{value:"Cluster Command",id:"cluster-command",children:[]},{value:"Providers",id:"providers",children:[{value:"AWS",id:"aws",children:[]},{value:"Google Cloud Platform",id:"google-cloud-platform",children:[]},{value:"Azure",id:"azure",children:[]}]},{value:"Setup",id:"setup",children:[]}],s={toc:i};function c(e){var n=e.components,l=(0,a.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,r.Z)({},s,l,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Cluster Management is the feature to manage server instancess on a cloud environment. Before ",(0,o.kt)("inlineCode",{parentName:"p"},"0.9.5"),", the server instances must be prepared and the IP addresses of the servers need to be defined in ",(0,o.kt)("inlineCode",{parentName:"p"},"kupboard.yaml"),". However, after ",(0,o.kt)("inlineCode",{parentName:"p"},"0.9.5"),", server instances are automatically created by kupboard based on the cluster structure defined in ",(0,o.kt)("inlineCode",{parentName:"p"},"kupboard.yaml"),". "),(0,o.kt)("p",null,"You can also use commands to manage instances such as ",(0,o.kt)("inlineCode",{parentName:"p"},"create"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"delete"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"start"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"stop"),". These commands would be very useful when you want to add or remove a node, or change an instance type as different situations."),(0,o.kt)("p",null,"As shown below, Cluster Management automatically can handle many repetitive jobs that should be done manually. "),(0,o.kt)("br",null),(0,o.kt)("p",{align:"center"},(0,o.kt)("p",null,(0,o.kt)("img",{alt:"kupboard-cluster-management-04",src:t(7126).Z})),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Manual Cluster Management"))),(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("p",{align:"center"},(0,o.kt)("p",null,(0,o.kt)("img",{alt:"kupboard-cluster-management-05",src:t(6683).Z})),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Automatic Cluster Management"))),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"cluster"},"Cluster"),(0,o.kt)("br",null),(0,o.kt)("p",{align:"center"},(0,o.kt)("img",{width:"480",src:"/img/cluster-management/cluster-management-01.png",alt:"kupboard-cluster-management-01"})),(0,o.kt)("br",null),(0,o.kt)("p",null,"If you want to manage servers manually, you can build a service environment by defining the IP addresses of the servers in the cluster in ",(0,o.kt)("inlineCode",{parentName:"p"},"kupboard.yaml"),". If the cluster contains  1 admin server, 3 gateway servers, and 4 service servers as shown above, the cluster definition would be as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cluster:\n  admin:\n    - name: admin-node1\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n\n  gateway:\n    - name: gateway-node1\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n    - name: gateway-node2\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n    - name: gateway-node3\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n\n  service:\n    - name: service-node1\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n    - name: service-node2\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n    - name: service-node3\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n    - name: service-node4\n      public_ip: x.x.x.x\n      private_ip: x.x.x.x\n")),(0,o.kt)("h2",{id:"cluster-group"},"Cluster Group"),(0,o.kt)("br",null),(0,o.kt)("p",{align:"center"},(0,o.kt)("img",{width:"480",src:"/img/cluster-management/cluster-management-02.png",alt:"kupboard-cluster-management-02"})),(0,o.kt)("br",null),(0,o.kt)("p",null,"If you use Cluster Group, you only need to define the names of the clusters and the number of servers for clusters instead of all IP addresses of servers as follows. Based on this cluster structure, kupboard automatically creates server instances. For more detail, see ",(0,o.kt)("a",{parentName:"p",href:"#cluster-command"},"Cluster Commands"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"clusterGroups:\n  - name: group1\n    cluster:\n      - name: admin\n        count: 1\n      - name: gateway\n        count: 3\n      - name: service\n        count: 4\n")),(0,o.kt)("p",null,"However, For kupboard to control server instances the credential and information of a cloud provider is required and they can be defined as below. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'clusterGroups:\n  - name: group1\n    provider: aws\n    credentials: \n      access_key: "AWS_SECRET_KEY"\n      secret_key: "AWS_ACCESS_KEY"\n    instance:\n      zone: ap-northeast-2a\n      region: ap-northeast-2\n      instance_type: "t3.large"\n      ami: "ami-04876f29fd3a5e8ba" # ubuntu20.4\n      volume_size: 50\n      subnet_cidr: 172.31.0.0/20\n    cluster:\n      - name: admin\n        count: 1\n      - name: gateway\n        count: 3\n      - name: service\n        count: 4\n')),(0,o.kt)("p",null,"If you want to divide a cluster into multi groups, you can define groups as follows. This is related to Multi Cloud, please see ",(0,o.kt)("a",{parentName:"p",href:"/docs/multi-cloud"},"Multi Cloud")," for more information"),(0,o.kt)("br",null),(0,o.kt)("p",{align:"center"},(0,o.kt)("img",{width:"480",src:"/img/cluster-management/cluster-management-03.png",alt:"kupboard-cluster-management-03"})),(0,o.kt)("br",null),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"clusterGroups:\n  - name: group1\n    ...\n    cluster:\n      - name: admin\n        count: 1\n      - name: gateway\n        count: 3\n  - name: group2\n    ...\n    cluster:\n      - name: service\n        count: 4\n")),(0,o.kt)("h2",{id:"cluster-command"},"Cluster Command"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create or delete all cluster groups")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kupboard cluster -a <create|delete>\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create or delete a cluster group")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kupboard cluster -a <create|delete> --group <group-name>\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create, start, stop or delete an instance")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kupboard cluster -a <create|start|stop|delete> --node <node-name>\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Update local cluster information from a cloud provider")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kupboard cluster -a status\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Show current cluster information")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kupboard cluster\n")),(0,o.kt)("h2",{id:"providers"},"Providers"),(0,o.kt)("p",null,"The information required to manage instances depends on a cloud provider. Below are the examples for AWS, MS Azure and Google Cloud Platform."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Currently Cluster Group supports AWS, MS Azure and Google Cloud Platform."))),(0,o.kt)("h3",{id:"aws"},"AWS"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'clusterGroups:\n  - name: group1\n    provider: aws\n    credentials: \n      access_key: "AWS_SECRET_KEY"\n      secret_key: "AWS_ACCESS_KEY"\n    instance:\n      zone: ap-northeast-2a\n      region: ap-northeast-2\n      instance_type: "t3.large"\n      ami: "ami-04876f29fd3a5e8ba" # ubuntu20.4\n      volume_size: 50\n      subnet_cidr: 172.31.0.0/20\n    cluster:\n      - name: admin\n        count: 1\n        instance_type: "t3.medium"      \n      - name: gateway\n        count: 3\n      - name: service\n        count: 4\n')),(0,o.kt)("h3",{id:"google-cloud-platform"},"Google Cloud Platform"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'clusterGroups:\n  - name: group2\n    provider: gcp\n    credentials: \n      service_account_file: <gcp-key-file.json>\n      project_id: <gcp-project-id>\n    instance:\n      instance_type: "n1-standard-1"\n      source_image: projects/ubuntu-os-cloud/global/images/family/ubuntu-1804-lts\n      zone: asia-northeast3-a\n      region: asia-northeast3\n      volume_size: 50\n      subnet_cidr: 10.240.0.0/24\n    cluster:\n      - name: admin\n        count: 1\n      - name: gateway\n        count: 3\n      - name: service\n        count: 4\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"gcp-key-file.json")," A key file of your google project and it must be located in ",(0,o.kt)("inlineCode",{parentName:"li"},"data/certs"),".")),(0,o.kt)("h3",{id:"azure"},"Azure"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"clusterGroups:\n\n  - name: group3\n    provider: azure\n    credentials: \n      subscription_id: <subscription-id>\n      client_id: <client-id>\n      secret: <secret>\n      tenant: <tenant-id>\n    instance:\n      instance_type: Standard_DS2_v2\n      image_sku: 18.04-LTS # ubuntu\n      region: koreacentral\n      volume_size: 50\n      subnet_cidr: 10.240.0.0/24\n    cluster:\n      - name: admin\n        count: 1\n      - name: gateway\n        count: 3\n      - name: service\n        count: 4\n")),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("p",null,"When you create a cluster by using the ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster")," command, the default user with a root permission is automatically created. The username is ",(0,o.kt)("inlineCode",{parentName:"p"},"kupboard")," for GCP and Azure and, ",(0,o.kt)("inlineCode",{parentName:"p"},"ubuntu")," for AWS."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kupboard setup --init-user --root-username <username>\n")))}c.isMDXComponent=!0},7126:function(e,n,t){"use strict";n.Z=t.p+"assets/images/cluster-management-04-6ce4401a5863d1a092f3bbccb6d06157.png"},6683:function(e,n,t){"use strict";n.Z=t.p+"assets/images/cluster-management-05-f61064e944944ab98345ebcffb524b0c.png"}}]);